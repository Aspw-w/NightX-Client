package net.aspw.client.features.module.modules.exploit

import net.aspw.client.event.EventTarget
import net.aspw.client.event.PacketEvent
import net.aspw.client.event.UpdateEvent
import net.aspw.client.features.module.Module
import net.aspw.client.features.module.ModuleCategory
import net.aspw.client.features.module.ModuleInfo
import net.minecraft.network.play.client.C18PacketSpectate


@ModuleInfo(name = "EntityDesync", spacedName = "Entity Desync", category = ModuleCategory.EXPLOIT)
class EntityDesync : Module() {
    override fun onEnable() {
        if (mc.thePlayer.isRiding) {
            mc.thePlayer.dismountEntity(mc.thePlayer.ridingEntity)
            mc.theWorld.removeEntity(mc.thePlayer.ridingEntity)
        } else {
            chat("You are not riding entity!")
        }
    }

    @EventTarget
    fun onUpdate(event: UpdateEvent?) {
        if (mc.theWorld != null && mc.thePlayer != null) {
            if (mc.thePlayer.ridingEntity == null || mc.thePlayer.isRiding) return
            mc.thePlayer.ridingEntity.setPosition(mc.thePlayer.posX, mc.thePlayer.posY, mc.thePlayer.posZ)
        }
    }

    fun onPacket(event: PacketEvent) {
        val packet = event.packet
        if (packet is C18PacketSpectate) {
            event.cancelEvent()
        }
    }
}